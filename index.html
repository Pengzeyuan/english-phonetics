<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‹±è¯­éŸ³æ ‡å‘éŸ³å¡ç‰‡</title>

     <!-- PWAé…ç½® -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4a90e2">
    
    <!-- iOSæ”¯æŒ -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="å•å…ƒéŸ³1">
    <link rel="apple-touch-icon" href="images/icon-192.png">  <!-- âœ… æ­£ç¡®è·¯å¾„ -->
    
    <!-- Android Chrome -->
    <meta name="mobile-web-app-capable" content="yes">

    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            padding: 30px;
            position: relative;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 3px solid #e74c3c;
        }

        h1 {
            color: #2c3e50;
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        .subtitle {
            color: #7f8c8d;
            font-size: 1.2rem;
            margin-top: 10px;
        }

        .group-container {
            margin-bottom: 50px;
        }

        .group-header {
            background: linear-gradient(to right, #e74c3c, #ff7979);
            color: white;
            padding: 15px 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.2);
        }

        .group-title {
            font-size: 1.5rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .group-subtitle {
            font-size: 1rem;
            opacity: 0.9;
        }

        .group-1 .group-header .group-title:before {
            content: "ğŸ˜£ ";
        }

        .group-2 .group-header {
            background: linear-gradient(to right, #00b894, #55efc4);
        }

        .group-2 .group-header .group-title:before {
            content: "ğŸ˜Š ";
        }

        .group-3 .group-header {
            background: linear-gradient(to right, #fdcb6e, #ffeaa7);
        }

        .group-3 .group-header .group-title:before {
            content: "ğŸ‘„ ";
        }

        /* ç®€åŒ–å¡ç‰‡å¸ƒå±€ */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        @media (max-width: 768px) {
            .cards-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
        }

        /* æç®€å¡ç‰‡è®¾è®¡ */
        .phonetic-card {
            position: relative;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            /*height: 420px;  å¢åŠ é«˜åº¦ä¸ºè¿›åº¦æ¡ç•™ç©ºé—´ */

             /* ä½¿ç”¨å®½é«˜æ¯”å®¹å™¨ */
            aspect-ratio: 1170 / (1600 + 80); /* å›¾ç‰‡é«˜åº¦+è¿›åº¦æ¡é«˜åº¦ */

            cursor: default;
        }

        .phonetic-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
        }

        /* å¡ç‰‡å†…å®¹åŒºåŸŸ */
        .card-content {
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
        }

        /* å›¾ç‰‡å®¹å™¨ - æ·»åŠ ç‚¹å‡»åŒºåŸŸé™åˆ¶ */
        .image-container {
            width: 100%;
            height: calc(100% - 80px); /* å›¾ç‰‡åŒºåŸŸé«˜åº¦ï¼Œé¿å¼€åº•éƒ¨åŒºåŸŸ */
            position: relative;
            cursor: pointer;
            overflow: hidden;
        }

        .card-image {
            width: 100%;
            height: 100%;
            object-fit: contain;
            transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            background: #fefefe;
            transform-style: preserve-3d;
            padding: 10px;
        }

        /* ä¸ºç¿»è½¬åçš„å›¾ç‰‡æ·»åŠ ä¿®æ­£ */
        .card-image.flipped {
            transform: rotateY(180deg) scaleX(-1); /* æ·»åŠ  scaleX(-1) ä¿®æ­£é•œåƒ */
        }

        /* è¿›åº¦æ¡å®¹å™¨ - æ”¾åœ¨å¡ç‰‡åº•éƒ¨ï¼Œä¸å¯ç‚¹å‡»ç¿»è½¬ */
        .audio-progress-container {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 80px; /* å¢åŠ é«˜åº¦ï¼Œç¡®ä¿æœ‰è¶³å¤Ÿçš„éç‚¹å‡»åŒºåŸŸ */
            background: rgba(248, 249, 250, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 0 15px;
            z-index: 15;
            border-top: 1px solid #e9ecef;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s ease;
            cursor: default; /* è¿›åº¦æ¡åŒºåŸŸé»˜è®¤å…‰æ ‡ */
        }

        .audio-progress-container.active {
            opacity: 1;
            transform: translateY(0);
        }

        /* è¿›åº¦æ¡æ ·å¼ */
        .audio-progress {
            width: 100%;
            height: 6px;
            background: rgba(189, 195, 199, 0.3);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 8px;
            cursor: pointer; /* åªæœ‰è¿›åº¦æ¡æœ¬èº«å¯ç‚¹å‡» */
            position: relative;
        }

        .audio-progress:hover {
            height: 8px;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(to right, #3498db, #2ecc71);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 3px;
        }

        /* æ—¶é—´æ˜¾ç¤º */
        .time-display {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.75rem;
            color: #7f8c8d;
            user-select: none; /* é˜²æ­¢æ–‡å­—è¢«é€‰ä¸­ */
        }

        .current-time, .total-time {
            font-family: 'Consolas', 'Monaco', monospace;
            font-weight: 600;
        }

        /* æ‚¬æµ®æ’­æ”¾æŒ‰é’® - å›ºå®šåœ¨å³ä¸‹è§’ */
        .play-btn-overlay {
            position: absolute;
            bottom: 90px; /* åœ¨è¿›åº¦æ¡ä¸Šæ–¹æ›´é«˜ä½ç½® */
            right: 15px;
            background: rgba(52, 152, 219, 0.85);
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 20;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
            font-size: 1.3rem;
        }

        .play-btn-overlay:hover {
            background: rgba(41, 128, 185, 0.95);
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(41, 128, 185, 0.4);
        }

        .play-btn-overlay.playing {
            background: rgba(231, 76, 60, 0.9);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
            }
            50% {
                box-shadow: 0 4px 20px rgba(231, 76, 60, 0.6);
            }
            100% {
                box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
            }
        }

        /* å›¾ç‰‡ç¿»è½¬æç¤ºï¼ˆå¯é€‰ï¼Œæ”¾åœ¨å›¾ç‰‡åŒºåŸŸå³ä¸Šè§’ï¼‰ */
        .flip-hint {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255, 255, 255, 0.9);
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
            color: #636e72;
            /*display: flex;*/
            display: none; /* æ”¹ä¸º none è®©æç¤ºæ¶ˆå¤± */
            align-items: center;
            gap: 5px;
            z-index: 10;
            pointer-events: none; /* æç¤ºæ–‡å­—ä¸å“åº”ç‚¹å‡» */
            opacity: 0.7;
            transition: opacity 0.3s ease;
        }

        .image-container:hover .flip-hint {
            opacity: 1;
        }

        .footer {
            text-align: center;
            margin-top: 50px;
            color: #7f8c8d;
            font-size: 0.9rem;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
        }

        /* å›¾ç‰‡åŠ è½½å¤±è´¥æ ·å¼ */
        .image-error {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #636e72;
            font-size: 1rem;
            text-align: center;
            padding: 30px;
            background: #f8f9fa;
        }

        /* å®‰å…¨çš„ç‚¹å‡»åŒºåŸŸåˆ†éš”çº¿ï¼ˆå¯é€‰ï¼Œç”¨äºè§†è§‰åŒºåˆ†ï¼‰ */
        .safe-area-line {
            position: absolute;
            bottom: 80px;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(to right, transparent, rgba(0, 0, 0, 0.1), transparent);
            pointer-events: none;
            z-index: 5;
        }

        @media (max-width: 480px) {
            .phonetic-card {
                height: 380px;
            }
            
            .image-container {
                height: calc(100% - 70px);
            }
            
            .audio-progress-container {
                height: 70px;
                padding: 0 10px;
            }
            
            .play-btn-overlay {
                bottom: 80px;
                width: 45px;
                height: 45px;
                font-size: 1.2rem;
            }
            
            .time-display {
                font-size: 0.7rem;
            }
            
            .flip-hint {
                font-size: 0.7rem;
                padding: 3px 8px;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>ğŸ”Š è‹±è¯­å•å…ƒéŸ³å‘éŸ³å¡ç‰‡</h1>
        <p class="subtitle">ç‚¹å‡»å›¾ç‰‡ç¿»è½¬å¡ç‰‡ï¼Œç‚¹å‡»æŒ‰é’®æ’­æ”¾å‘éŸ³</p>
    </div>

    <!-- ç¬¬ä¸€ç»„ï¼šä¸¤éš¾éŸ³ç»„ -->
    <div class="group-container group-1">
        <div class="group-header">
            <div>
                <div class="group-title">ä¸¤éš¾éŸ³ç»„</div>
                <div class="group-subtitle">ä¸æ‹¼éŸ³å‘éŸ³ä¸åŒï¼Œéœ€è¦é‡ç‚¹ç»ƒä¹  /Ã¦/ /e/ /É‘Ë/ /ÊŒ/</div>
            </div>
        </div>
        <div class="cards-grid" id="group1Cards">
            <!-- å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
        </div>
    </div>

    <div class="footer">
        <p>è‹±è¯­å•å…ƒéŸ³å‘éŸ³å­¦ä¹ ç³»ç»Ÿ Â· æç®€è®¾è®¡ï¼šå›¾ç‰‡+éŸ³é¢‘</p>
        <p>ç‚¹å‡»å›¾ç‰‡ç¿»è½¬ï¼Œç‚¹å‡»æ‚¬æµ®æŒ‰é’®æ’­æ”¾å‘éŸ³</p>
    </div>
</div>

<script>
    // æç®€éŸ³æ ‡æ•°æ® - åªä¿ç•™å›¾ç‰‡å’ŒéŸ³é¢‘è·¯å¾„
    const phoneticData = {
        group1: [
            {
                frontImage: "images/æŒ¨.jpg",      // æ­£é¢å›¾ç‰‡
                backImage: "images/æŒ¨å•è¯.jpg",   // èƒŒé¢å›¾ç‰‡
                audio: "audio/ant.mp3"         // éŸ³é¢‘æ–‡ä»¶
            },
            {
                frontImage: "images/å“.jpg",   // æ‚¨éœ€è¦æä¾›
                backImage: "images/å“å•è¯.jpg",    // æ‚¨éœ€è¦æä¾›
                audio: "audio/head.mp3"             // æ‚¨éœ€è¦æä¾›
            },
            {
                frontImage: "images/å•Š--.jpg",   // æ‚¨éœ€è¦æä¾›
                backImage: "images/å•Š--å•è¯.jpg",    // æ‚¨éœ€è¦æä¾›
                audio: "audio/father.mp3"             // æ‚¨éœ€è¦æä¾›
            },
            {
                frontImage: "images/å•Š.jpg",   // æ‚¨éœ€è¦æä¾›
                backImage: "images/å•Šå•è¯.jpg",    // æ‚¨éœ€è¦æä¾›
                audio: "audio/son.mp3"             // æ‚¨éœ€è¦æä¾›
            }
        ]
    };

    // éŸ³é¢‘ç®¡ç†
    let currentAudio = null;
    let currentPlayingCardId = null;

    // åˆå§‹åŒ–é¡µé¢
    function initPage() {
        renderGroupCards('group1Cards', phoneticData.group1);
        setupImageErrorHandling();
    }

    // æ¸²æŸ“å¡ç‰‡
    function renderGroupCards(containerId, cardsData) {
        const container = document.getElementById(containerId);
        if (!container) return;

        container.innerHTML = '';

        cardsData.forEach((phonetic, index) => {
            const cardId = `card-${index}`;
            const cardHtml = `
                <div class="phonetic-card" id="${cardId}">
                    <div class="card-content">
                        <!-- å›¾ç‰‡å®¹å™¨ - é™åˆ¶ç‚¹å‡»åŒºåŸŸ -->
                        <div class="image-container" id="image-container-${cardId}">
                            <img src="${phonetic.frontImage}"
                                 alt="éŸ³æ ‡å¡ç‰‡"
                                 class="card-image"
                                 id="image-${cardId}">
                            <div class="flip-hint">
                                <span>ğŸ”„</span> ç‚¹å‡»ç¿»è½¬
                            </div>
                        </div>
                        
                        <!-- å®‰å…¨çš„ç‚¹å‡»åŒºåŸŸåˆ†éš”çº¿ï¼ˆå¯é€‰ï¼‰ -->
                        <div class="safe-area-line"></div>
                        
                        <!-- è¿›åº¦æ¡å®¹å™¨ -->
                        <div class="audio-progress-container" id="progress-container-${cardId}">
                            <div class="audio-progress" id="progress-${cardId}">
                                <div class="progress-bar" id="progress-bar-${cardId}"></div>
                            </div>
                            <div class="time-display">
                                <span class="current-time" id="current-time-${cardId}">0:00</span>
                                <span class="total-time" id="total-time-${cardId}">0:00</span>
                            </div>
                        </div>
                        
                        <button class="play-btn-overlay" id="play-btn-${cardId}">
                            ğŸ”Š
                        </button>
                    </div>
                </div>
            `;

            container.insertAdjacentHTML('beforeend', cardHtml);

            // ç»‘å®šäº‹ä»¶
            const imageContainer = document.getElementById(`image-container-${cardId}`);
            const imageElement = document.getElementById(`image-${cardId}`);
            const playButton = document.getElementById(`play-btn-${cardId}`);
            const progressElement = document.getElementById(`progress-${cardId}`);

            // ç‚¹å‡»å›¾ç‰‡åŒºåŸŸç¿»è½¬
            imageContainer.addEventListener('click', function (e) {
                // ç¡®ä¿ç‚¹å‡»çš„æ˜¯å›¾ç‰‡å®¹å™¨æœ¬èº«ï¼Œä¸æ˜¯å­å…ƒç´ 
                if (e.target === this || e.target === imageElement) {
                    toggleImageFlip(cardId);
                }
            });

            // ç‚¹å‡»æ’­æ”¾æŒ‰é’®
            playButton.addEventListener('click', function (e) {
                e.stopPropagation();
                playAudio(cardId, phonetic.audio);
            });

            // ç‚¹å‡»è¿›åº¦æ¡è·³è½¬
            progressElement.addEventListener('click', function (e) {
                e.stopPropagation(); // é˜»æ­¢äº‹ä»¶å†’æ³¡åˆ°å›¾ç‰‡å®¹å™¨
                if (currentAudio && currentPlayingCardId === cardId) {
                    const rect = this.getBoundingClientRect();
                    const clickX = e.clientX - rect.left;
                    const width = rect.width;
                    const percent = Math.min(Math.max(clickX / width, 0), 1);
                    
                    currentAudio.currentTime = percent * currentAudio.duration;
                }
            });
        });
    }

    // ç¿»è½¬å›¾ç‰‡
    function toggleImageFlip(cardId) {
        const image = document.getElementById(`image-${cardId}`);
        const imageContainer = document.getElementById(`image-container-${cardId}`);

        if (!image || !imageContainer) return;

        const phonetic = findPhoneticById(cardId);
        if (!phonetic) return;

        if (image.classList.contains('flipped')) {
            // ç¿»å›æ­£é¢
            image.classList.remove('flipped');
            setTimeout(() => {
                image.src = phonetic.frontImage;
            }, 400);
        } else {
            // ç¿»åˆ°èƒŒé¢
            image.classList.add('flipped');
            setTimeout(() => {
                image.src = phonetic.backImage;
            }, 400);
        }
    }

    // æ ¹æ®IDæŸ¥æ‰¾éŸ³æ ‡æ•°æ®
    function findPhoneticById(cardId) {
        const index = parseInt(cardId.split('-')[1]);
        return phoneticData.group1[index];
    }

    // æ’­æ”¾éŸ³é¢‘ - å¸¦è¿›åº¦æ¡ç‰ˆæœ¬
    function playAudio(cardId, audioPath) {
        const playBtn = document.getElementById(`play-btn-${cardId}`);
        const progressContainer = document.getElementById(`progress-container-${cardId}`);
        const progressBar = document.getElementById(`progress-bar-${cardId}`);
        const currentTimeDisplay = document.getElementById(`current-time-${cardId}`);
        const totalTimeDisplay = document.getElementById(`total-time-${cardId}`);

        // å¦‚æœæ­£åœ¨æ’­æ”¾å½“å‰å¡ç‰‡ï¼Œåˆ™åœæ­¢
        if (currentPlayingCardId === cardId && currentAudio && !currentAudio.paused) {
            stopAudio(cardId);
            return;
        }

        // å¦‚æœæ­£åœ¨æ’­æ”¾å…¶ä»–å¡ç‰‡ï¼Œå…ˆåœæ­¢
        if (currentPlayingCardId && currentPlayingCardId !== cardId) {
            stopAudio(currentPlayingCardId);
        }

        // æ›´æ–°UIçŠ¶æ€
        playBtn.classList.add('playing');
        playBtn.textContent = 'â¸ï¸';
        progressContainer.classList.add('active');

        // åˆ›å»ºéŸ³é¢‘å¯¹è±¡
        currentAudio = new Audio(audioPath);
        currentPlayingCardId = cardId;

        // è®¾ç½®åˆå§‹éŸ³é‡
        currentAudio.volume = 0.7;

        // æ—¶é—´æ ¼å¼åŒ–å‡½æ•°
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
        }

        // æ›´æ–°è¿›åº¦æ¡å’Œæ—¶é—´æ˜¾ç¤º
        function updateProgress() {
            if (!currentAudio || currentAudio.readyState < 2) return;

            const currentTime = currentAudio.currentTime;
            const duration = currentAudio.duration || 1;
            const progressPercent = (currentTime / duration) * 100;

            progressBar.style.width = `${progressPercent}%`;
            currentTimeDisplay.textContent = formatTime(currentTime);
            
            // åªåœ¨å¼€å§‹æ—¶æ›´æ–°æ€»æ—¶é—´ä¸€æ¬¡
            if (totalTimeDisplay.textContent === '0:00') {
                totalTimeDisplay.textContent = formatTime(duration);
            }
        }

        // ç®€å•çš„äº‹ä»¶å¤„ç†
        currentAudio.oncanplaythrough = () => {
            // å¼€å§‹è¿›åº¦æ›´æ–°
            currentAudio.ontimeupdate = updateProgress;
            
            // è®¾ç½®æ€»æ—¶é—´
            totalTimeDisplay.textContent = formatTime(currentAudio.duration);
            
            currentAudio.play().catch(error => {
                console.error('æ’­æ”¾å¤±è´¥:', error);
                resetAudioState(cardId);
            });
        };

        currentAudio.onerror = (e) => {
            console.error('éŸ³é¢‘é”™è¯¯:', e);
            resetAudioState(cardId);
        };

        currentAudio.onended = () => {
            resetAudioState(cardId);
            // 3ç§’åéšè—è¿›åº¦æ¡
            setTimeout(() => {
                if (currentPlayingCardId !== cardId) {
                    progressContainer.classList.remove('active');
                    progressBar.style.width = '0%';
                    currentTimeDisplay.textContent = '0:00';
                    totalTimeDisplay.textContent = '0:00';
                }
            }, 3000);
        };

        // å¼€å§‹åŠ è½½
        currentAudio.load();
    }

    // åœæ­¢éŸ³é¢‘
    function stopAudio(cardId) {
        if (currentAudio) {
            currentAudio.pause();
            currentAudio.currentTime = 0;
            currentAudio = null;
        }

        resetAudioState(cardId);

        const progressContainer = document.getElementById(`progress-container-${cardId}`);
        const progressBar = document.getElementById(`progress-bar-${cardId}`);
        const currentTimeDisplay = document.getElementById(`current-time-${cardId}`);
        const totalTimeDisplay = document.getElementById(`total-time-${cardId}`);

        if (progressContainer) {
            progressContainer.classList.remove('active');
        }

        if (progressBar) {
            progressBar.style.width = '0%';
        }

        if (currentTimeDisplay) {
            currentTimeDisplay.textContent = '0:00';
        }
        
        if (totalTimeDisplay) {
            totalTimeDisplay.textContent = '0:00';
        }
    }

    // é‡ç½®éŸ³é¢‘çŠ¶æ€
    function resetAudioState(cardId) {
        const playBtn = document.getElementById(`play-btn-${cardId}`);
        if (playBtn) {
            playBtn.classList.remove('playing');
            playBtn.textContent = 'ğŸ”Š';
        }

        if (currentPlayingCardId === cardId) {
            currentPlayingCardId = null;
        }
    }

    // è®¾ç½®å›¾ç‰‡åŠ è½½å¤±è´¥å¤„ç†
    function setupImageErrorHandling() {
        document.addEventListener('error', function (e) {
            if (e.target.tagName === 'IMG' && e.target.classList.contains('card-image')) {
                console.error('å›¾ç‰‡åŠ è½½å¤±è´¥:', e.target.src);

                const container = e.target.parentElement;
                const errorDiv = document.createElement('div');
                errorDiv.className = 'image-error';
                errorDiv.innerHTML = `
                    <div style="font-size: 2rem; margin-bottom: 10px;">ğŸ“·</div>
                    <div>å›¾ç‰‡åŠ è½½å¤±è´¥</div>
                `;

                e.target.style.display = 'none';
                container.appendChild(errorDiv);
            }
        }, true);
    }

    // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', initPage);

    // åœ¨ç°æœ‰çš„JavaScriptä»£ç åæ·»åŠ 
    // Service Worker æ³¨å†Œå’Œç®¡ç†
    if ('serviceWorker' in navigator) {
      let refreshing = false;
      
      // é¡µé¢åŠ è½½åæ³¨å†Œ
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('service-worker.js')
          .then(registration => {
            console.log('âœ… Service Worker æ³¨å†ŒæˆåŠŸï¼Œä½œç”¨åŸŸ:', registration.scope);
            
            // æ£€æŸ¥æ›´æ–°
            registration.addEventListener('updatefound', () => {
              const newWorker = registration.installing;
              console.log('ğŸ”„ å‘ç°æ–°ç‰ˆæœ¬ Service Worker');
              
              newWorker.addEventListener('statechange', () => {
                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                  // æ–°ç‰ˆæœ¬å·²å®‰è£…ï¼Œæç¤ºç”¨æˆ·åˆ·æ–°
                  showUpdateNotification();
                }
              });
            });
            
            // ç›‘å¬æ§åˆ¶å™¨å˜åŒ–
            navigator.serviceWorker.addEventListener('controllerchange', () => {
              if (!refreshing) {
                refreshing = true;
                console.log('ğŸ‰ æ–°Service Workerå·²æ¿€æ´»ï¼Œé¡µé¢å³å°†åˆ·æ–°...');
                window.location.reload();
              }
            });
          })
          .catch(error => {
            console.error('âŒ Service Worker æ³¨å†Œå¤±è´¥:', error);
          });
      });
      
      // æ‰‹åŠ¨é¢„ç¼“å­˜å‡½æ•°
      function precacheAll() {
        if (navigator.serviceWorker.controller) {
          navigator.serviceWorker.controller.postMessage({
            action: 'precacheResources'
          });
        }
      }
      
      // æ‰‹åŠ¨æ›´æ–°å‡½æ•°
      function updateServiceWorker() {
        if (navigator.serviceWorker.controller) {
          navigator.serviceWorker.controller.postMessage({
            action: 'skipWaiting'
          });
        }
      }
      
      // æ˜¾ç¤ºæ›´æ–°é€šçŸ¥
      function showUpdateNotification() {
        // åˆ›å»ºæ›´æ–°æç¤º
        const updateDiv = document.createElement('div');
        updateDiv.id = 'update-notification';
        updateDiv.style.cssText = `
          position: fixed;
          bottom: 20px;
          left: 50%;
          transform: translateX(-50%);
          background: #2c3e50;
          color: white;
          padding: 12px 20px;
          border-radius: 10px;
          z-index: 10000;
          display: flex;
          align-items: center;
          gap: 15px;
          box-shadow: 0 4px 12px rgba(0,0,0,0.2);
          animation: slideUp 0.3s ease;
        `;
        
        updateDiv.innerHTML = `
          <span>ğŸ”„ æ–°ç‰ˆæœ¬å¯ç”¨</span>
          <button id="refreshBtn" style="
            background: #e74c3c;
            color: white;
            border: none;
            padding: 6px 15px;
            border-radius: 5px;
            cursor: pointer;
          ">ç«‹å³æ›´æ–°</button>
        `;
        
        document.body.appendChild(updateDiv);
        
        document.getElementById('refreshBtn').addEventListener('click', () => {
          updateServiceWorker();
        });
      }
      
      // æ·»åŠ åŠ¨ç”»
      const style = document.createElement('style');
      style.textContent = `
        @keyframes slideUp {
          from { transform: translateX(-50%) translateY(100%); opacity: 0; }
          to { transform: translateX(-50%) translateY(0); opacity: 1; }
        }
      `;
      document.head.appendChild(style);
      
      // é¡µé¢åŠ è½½å®Œæˆåï¼Œå¯ä»¥æ‰‹åŠ¨è§¦å‘é¢„ç¼“å­˜
      setTimeout(() => {
        // å¯ä»¥æ ¹æ®éœ€è¦æ‰‹åŠ¨è°ƒç”¨
        // precacheAll();
      }, 2000);
    }

        // PWAè°ƒè¯•è„šæœ¬
    console.log('=== PWAè°ƒè¯•ä¿¡æ¯ ===');
    console.log('å½“å‰URL:', window.location.href);
    console.log('å½“å‰è·¯å¾„:', window.location.pathname);
    console.log('é¡¹ç›®æ ¹è·¯å¾„:', window.location.origin + window.location.pathname.split('/').slice(0, -1).join('/'));

    // æ£€æŸ¥å…³é”®æ–‡ä»¶
    async function checkFile(url) {
        try {
            const response = await fetch(url);
            console.log(`${response.ok ? 'âœ…' : 'âŒ'} ${url} - HTTP ${response.status}`);
            return response.ok;
        } catch (error) {
            console.log(`âŒ ${url} - æ— æ³•è®¿é—®: ${error.message}`);
            return false;
        }
    }

    // é¡µé¢åŠ è½½åæ£€æŸ¥æ–‡ä»¶
    setTimeout(async () => {
        console.log('=== æ£€æŸ¥å…³é”®æ–‡ä»¶ ===');
        
        const filesToCheck = [
            'manifest.json',
            'service-worker.js',
            'images/icon-192.png',
            'images/icon-512.png',
            'images/æŒ¨.jpg',
            'audio/ant.mp3'
        ];
        
        for (const file of filesToCheck) {
            await checkFile(file);
        }
        
        console.log('=== æ–‡ä»¶æ£€æŸ¥å®Œæˆ ===');
        
        // æ£€æŸ¥Service Workeræ³¨å†Œ
        if ('serviceWorker' in navigator) {
            const registration = await navigator.serviceWorker.getRegistration();
            if (registration) {
                console.log('âœ… Service Workerå·²æ³¨å†Œ:', registration.scope);
                console.log('âœ… Service WorkerçŠ¶æ€:', registration.active ? 'æ´»è·ƒ' : 'æœªæ´»è·ƒ');
            } else {
                console.log('âŒ Service Workeræœªæ³¨å†Œ');
            }
        }
        
        // æ£€æŸ¥ç¼“å­˜
        if ('caches' in window) {
            const cacheNames = await caches.keys();
            console.log('ğŸ“¦ ç¼“å­˜åˆ—è¡¨:', cacheNames);
            
            for (const cacheName of cacheNames) {
                const cache = await caches.open(cacheName);
                const keys = await cache.keys();
                console.log(`  ç¼“å­˜ "${cacheName}" ä¸­æœ‰ ${keys.length} ä¸ªæ–‡ä»¶`);
            }
        }
    }, 2000);
</script>
</body>
</html>